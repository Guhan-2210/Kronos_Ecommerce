name = "catalog-worker"
main = "src/index.js"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# ============================================
# PREVIEW ENVIRONMENT (for PR testing)
# ============================================
[env.preview]
name = "catalog-worker-preview"

[[env.preview.d1_databases]]
binding = "DB"
database_name = "catalog_db_preview"
database_id = "520d7533-8d71-4e76-b329-1b1dbb0bfec6"  # TODO: Create separate preview DB

[[env.preview.kv_namespaces]]
binding = "SKU_CACHE"
id = "ef8d8cf8069d4f95acd9c9825d667645"  # TODO: Create separate preview KV

[[env.preview.r2_buckets]]
binding = "prod_images"
bucket_name = "product-images-preview"

[[env.preview.r2_buckets]]
binding = "LOGS_BUCKET"
bucket_name = "ecommerce-logs-preview"

[env.preview.vars]
ENVIRONMENT = "preview"
LOG_LEVEL = "DEBUG"
CACHE_TTL_SECONDS = "3600"
MEMORY_CACHE_SIZE = "100"
R2_PUBLIC_URL = "https://pub-114bdf3db04d44c7a8eb21b4bdc3ea6c.r2.dev"
HONEYCOMB_API_KEY = "hcaik_01karxr91gw57nz6qf7wjq6dasxfnpqsm8mgjdxg2xesvgt6c8etmwx9gg"

# ============================================
# PRODUCTION ENVIRONMENT
# ============================================
[env.production]
name = "catalog-worker"

[[env.production.d1_databases]]
binding = "DB"
database_name = "catalog_db"
database_id = "520d7533-8d71-4e76-b329-1b1dbb0bfec6"

[[env.production.kv_namespaces]]
binding = "SKU_CACHE"
id = "ef8d8cf8069d4f95acd9c9825d667645"

[[env.production.r2_buckets]]
binding = "prod_images"
bucket_name = "prod-images"

[[env.production.r2_buckets]]
binding = "LOGS_BUCKET"
bucket_name = "ecommerce-logs"

[env.production.vars]
ENVIRONMENT = "production"
LOG_LEVEL = "INFO"
CACHE_TTL_SECONDS = "3600"
MEMORY_CACHE_SIZE = "100"
R2_PUBLIC_URL = "https://pub-114bdf3db04d44c7a8eb21b4bdc3ea6c.r2.dev"
HONEYCOMB_API_KEY = "hcaik_01karxr91gw57nz6qf7wjq6dasxfnpqsm8mgjdxg2xesvgt6c8etmwx9gg"


